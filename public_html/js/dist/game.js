define("source/enum",[],function(){return{SHAPE_PLATE:{ROUND:1,RECT:2},GAME_STATE:{INIT:0,START:1,PAUSE:2,LEVEL_UP:3,PLAY:4,OVER:5},BULLET:{IRON_1:0,IRON_2:1,IRON_3:2,LAZER:3}}}),define("source/util",[],function(){return{calDistance:function(t,n,r,i){return Math.sqrt((t-r)*(t-r)+(n-i)*(n-i))},calAngle:function(e,t,n,r){var i=(r-t)/(n-e),s=Math.atan(i);return r<t&&n<e&&(s=Math.PI+s),s}}}),define("source/plate",["require","source/enum","source/weaponFactory","source/util"],function(e,t,n,r){var i=function(n,r){this.shape=n,this.x=0,this.y=0,this.dx=0,this.dy=0,this.angle=Math.PI/2,this.size=r,this.state=0,this.speed=0,this.fillStyle="#0000FF",this.strokeBodyStyle="#0000FF",this.strokeHitedBodyStyle="#DF0101",this.strokeGunStyle="white",this.edgeWidth=r/2,this.blood=100,this.isDied=!1,this.isHit=!1,this.bullets=e("source/weaponFactory").makeBullets(t.BULLET.IRON_2,1e5),this.numOfFiredBullets=0,this.isShot=!1};return i.prototype.setPosition=function(e,t){this.x=e,this.y=t},i.prototype.hit=function(){this.isHit=!0,this.blood-=5,this.blood<=0&&(this.isDied=!0)},i.prototype.fireGunner=function(e){var t=this.bullets[this.numOfFiredBullets],n=r.calAngle(this.x,this.y,e.gunX,e.gunY);t.update(this.x,this.y,n),this.numOfFiredBullets++},i.prototype.fire=function(e){for(var t=0,n=e[t];t<e.length;t++)this.fireGunner(n)},i.prototype.update=function(e){this.x+=this.dx,this.y+=this.dy,this.isHit=this.isHit&&!this.isHit,e&&this.fire(e);for(var t=0;t<this.numOfFiredBullets;t++){var n=this.bullets[t];n.update()}},i.prototype.render=function(e){this.isHit?this.renderHitedPlate(e):(this.renderBody(e),this.renderGun(e)),this.renderBullets(e)},i.prototype.renderBullets=function(e){for(var t=0;t<this.numOfFiredBullets;t++)this.bullets[t].render(e)},i.prototype.renderHitedPlate=function(e){this.renderBody(e),this.renderGun(e)},i.prototype.renderGun=function(e){e.save(),e.beginPath(),e.translate(this.x,this.y),e.rotate(this.angle),e.moveTo(0,0),e.lineTo(25,0),e.closePath(),e.strokeStyle=this.strokeGunStyle,e.lineWidth=5,e.stroke(),e.restore()},i.prototype.renderBody=function(e){e.save(),e.translate(this.x,this.y),e.beginPath();switch(this.shape){case t.SHAPE_PLATE.ROUND:e.arc(0,0,this.size,0,2*Math.PI,!1);break;case t.SHAPE_PLATE.RECT:e.rect(0-this.size,0-this.size,this.size*2,this.size*2)}e.lineWidth=this.edgeWidth,e.strokeStyle=this.isHit?this.strokeHitedBodyStyle:this.strokeBodyStyle,e.stroke(),e.closePath(),e.restore()},i}),define("source/bullet",["source/enum"],function(e){var t=function(e){this.strength=1,this.type=e,this.initX=0,this.initY=0,this.x=0,this.y=0,this.dx=10,this.dy=0,this.angle=0,this.isFired=!1,this.isExploded=!1};return t.prototype.update=function(e,t,n){this.isFired?(this.x+=this.dx,this.y+=this.dy):(this.initX=e,this.initY=t,this.angle=n,this.isFired=!0)},t.prototype.calAbsPosition=function(){var e={x:this.initX+this.x*Math.cos(this.angle),y:this.initY+this.x*Math.sin(this.angle)};return e},t.prototype.render=function(t){if(this.isFired&&!this.isExploded){t.save(),t.translate(this.initX,this.initY),t.rotate(this.angle),t.translate(this.x+50,this.y),t.beginPath(),t.moveTo(0,1),t.lineTo(10,1),t.lineTo(10,-1),t.lineTo(0,-1),t.closePath();switch(this.type){case e.BULLET.IRON_1:t.fillStyle="#DF0101",t.shadowColor="#DF0101";break;case e.BULLET.IRON_2:t.fillStyle="#01DF3A",t.shadowColor="#01DF3A"}t.shadowBlur=5,t.fill(),t.restore()}},t}),define("source/weaponFactory",["source/plate","source/bullet"],function(e,t){var n={};return n.makePlate=function(t,n){return new e(t,n)},n.makePlates=function(e,t,n){var r=[];for(var i=0;i<e;i++)r.push(this.makePlate(t,n));return r},n.makeBullet=function(e){return new t(e)},n.makeBullets=function(e,t){var n=[];for(var r=0;r<t;r++)n.push(this.makeBullet(e));return n},n}),define("source/player",["source/weaponFactory","source/enum"],function(e,t){var n=function(e,t){this.name=e,this.role=t,this.weapons=[],this.trackedGunners=[],this.isShot=!1};return n.prototype.start=function(){var n=e.makePlates(10,t.SHAPE_PLATE.ROUND,15);this.addWeapon(n),this.weapons.forEach(function(e,t){e.setPosition(t*100,10)})},n.prototype.addWeapon=function(e){var t=this.weapons;e.forEach(function(e){t.push(e)})},n.prototype.fireGunners=function(){this.isShot&&this.weapons.forEach(function(e){e.update(this.trackedGunners)},this)},n.prototype.trackGunners=function(e){this.trackedGunners=e},n.prototype.update=function(){this.weapons.forEach(function(e){e.update()},this)},n.prototype.render=function(e){this.weapons.forEach(function(t){t.render(e)})},n.prototype.removeDiedWeapons=function(){var e=this.weapons;for(var t=e.length-1;t>=0;t--){var n=e[t];n.isDied&&e.splice(t,1)}},n}),define("source/gunner",["source/weaponFactory","source/enum","source/util"],function(e,t,n){var r=function(e,t,n,r){this.bullets=[],this.x=e,this.y=t,this.angle=-Math.PI/2,this.fire=!1,this.gunX=n,this.gunY=r,this.isHit=!1,this.fillStyle="rgba(255,0,0, 0.5)",this.strokeStyle="rgb(255,0,0)",this.sightStyle="#FFFFFF",this.edgeWidth=1,this.sightSize=30,this.numOfFiredBullets=0};return r.prototype.addBullets=function(t,n){var r=e.makeBullets(t,n),i=this.bullets;r.forEach(function(e){i.push(e)})},r.prototype.start=function(){this.addBullets(t.BULLET.IRON_1,1e3)},r.prototype.update=function(e){this.x=e.mouseX,this.y=e.mouseY,this.fire=e.mouseDown,this.moveLeft=e.leftKey,this.moveRight=e.rightKey,this.moveLeft&&(this.gunX+=-10),this.moveRight&&(this.gunX+=10),this.angle=this.calAngleToTarget(this.gunX,this.gunY,this.x,this.y),this.fire&&this.numOfFiredBullets<this.bullets.length&&(this.bullets[this.numOfFiredBullets].update(this.gunX,this.gunY,this.angle),this.numOfFiredBullets+=1);for(var t=0;t<this.numOfFiredBullets;t++){var n=this.bullets[t];n.update()}},r.prototype.shoot=function(t){var n=t.weapons,r=0;return n.forEach(function(e){r+=this.shootWeapon(e)},this),t.removeDiedWeapons(),t.isShot=this.fire,r},r.prototype.shootWeapon=function(e){var r=0;if(e.shape===t.SHAPE_PLATE.ROUND)for(var i=0;i<this.numOfFiredBullets;i++){var s=this.bullets[i];if(s.isExploded)continue;var o=s.calAbsPosition();if(o.x<0)continue;var u=n.calDistance(o.x,o.y,e.x,e.y);u<this.sightSize&&(e.hit(),s.isExploded=!0,r++)}return r},r.prototype.renderSight=function(e){e.save(),e.translate(this.x,this.y),e.beginPath(),e.arc(0,0,this.sightSize,0,2*Math.PI),e.fillStyle=this.fillStyle,e.fill(),e.lineWidth=this.edgeWidth,e.strokeStyle=this.strokeStyle,e.stroke(),e.closePath(),e.restore()},r.prototype.renderTarget=function(e){e.save(),e.translate(this.x,this.y),e.beginPath(),e.moveTo(0,0-this.sightSize),e.lineTo(0,this.sightSize),e.moveTo(0-this.sightSize,0),e.lineTo(this.sightSize,0),e.closePath(),e.strokeStyle=this.sightStyle,e.stroke(),e.restore()},r.prototype.calAngleToTarget=n.calAngle,r.prototype.renderBody=function(e){e.save(),e.translate(this.gunX,this.gunY),e.rotate(this.angle),e.beginPath(),e.moveTo(0,0),e.lineTo(20,0),e.strokeStyle="#FFFFFF",e.lineWidth=this.sightSize/2,e.lineCap="round",e.stroke(),e.moveTo(20,0),e.lineTo(50,0),e.strokeStyle="#FFFFFF",e.lineWidth=this.sightSize/4,e.lineCap="round",e.stroke(),e.closePath(),e.restore()},r.prototype.renderBase=function(e){e.save(),e.translate(this.gunX,this.gunY),e.beginPath(),e.arc(0,0,this.sightSize,0,Math.PI,!0),e.fillStyle=this.fillStyle,e.fill(),e.strokeStyle=this.strokeStyle,e.lineWidth=this.sightSize/2,e.stroke(),e.closePath(),e.restore()},r.prototype.renderGun=function(e){this.renderBase(e),this.renderBody(e)},r.prototype.renderBullets=function(e){this.bullets.forEach(function(t){t.render(e)})},r.prototype.render=function(e){this.renderGun(e),this.renderSight(e),this.renderTarget(e),this.renderBullets(e)},r}),define("source/game",["source/enum","source/player","source/gunner"],function(e,t,n){var r=function(){this.players=[],this.gunners=[],this.ctx=null,this.theCanvas=null,this.currentGameState=e.GAME_STATE.INIT,this.keyPressList={},this.isMouseDown=!1,this.background={width:800,height:600,color:"#000000"},this.mouseX=this.background.width/2,this.mouseY=this.background.height/2,this.laserSound=null};return r.prototype.loadSound=function(){var e;e=document.createElement("audio"),document.body.appendChild(e),e.setAttribute("src","sound/laser.mp3"),this.laserSound=e},r.prototype.addPlayer=function(e){var n=new t(e);return this.players.push(n),n},r.prototype.addGunner=function(e){var t=new n(this.background.width/2,this.background.height/2,this.background.width/2,this.background.height);return this.gunners.push(t),t},r.prototype.drawBackground=function(){this.ctx.fillStyle=this.background.color,this.ctx.fillRect(0,0,this.background.width,this.background.height),this.drawBorder()},r.prototype.drawBorder=function(){this.ctx.strokeStyle="#FF0000",this.ctx.strokeRect(1,1,this.background.width-1,this.background.height-1)},r.prototype.getContext=function(){this.theCanvas=document.getElementById("game"),this.ctx=this.theCanvas.getContext("2d"),this.ctx.height=this.theCanvas.height,this.ctx.width=this.theCanvas.width},r.prototype.registerKey=function(){var e=this;document.onkeydown=function(t){t=t?t:window.event,e.keyPressList[t.keyCode]=!0},document.onkeyup=function(t){t=t?t:window.event,e.keyPressList[t.keyCode]=!1}},r.prototype.registerMouse=function(){document.addEventListener("mousemove",this.updateMousePosition.bind(this),!1),document.addEventListener("mousedown",this.updateMouseDownClick.bind(this),!1),document.addEventListener("mouseup",this.updateMouseUpClick.bind(this),!1)},r.prototype.updateMouseUpClick=function(e){this.isMouseDown=!1},r.prototype.updateMouseDownClick=function(e){this.isMouseDown=!0},r.prototype.updateMousePosition=function(e){var t=this.theCanvas.getBoundingClientRect();this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top,this.mouseY>this.background.height&&(this.mouseY=this.background.height),this.mouseX>this.background.width&&(this.mouseX=this.background.width)},r.prototype.start=function(){this.loadSound(),this.getContext(),this.registerKey(),this.registerMouse();var t=this.addPlayer("player1"),n=this.addGunner("gunner1");t.start(),t.trackGunners([n]),n.start(),this.switchGameState(e.GAME_STATE.INIT)},r.prototype.update=function(){var t={mouseX:this.mouseX,mouseY:this.mouseY,mouseDown:this.isMouseDown||this.keyPressList[13],leftKey:this.keyPressList[37]||this.keyPressList[65],rightKey:this.keyPressList[39]||this.keyPressList[68]};this.players.forEach(function(e){e.update(t)}),this.gunners.forEach(function(e){e.update(t),t.mouseDown&&this.laserSound.play()},this),this.currentGameState===e.GAME_STATE.PLAY&&this.checkCollision()},r.prototype.render=function(){var e=this.ctx;this.players.forEach(function(t){t.render(e)}),this.gunners.forEach(function(t){t.render(e)})},r.prototype.checkCollision=function(){this.gunners.forEach(function(e){this.players.forEach(function(t){e.shoot(t)},this)},this),this.players.forEach(function(e){e.fireGunners()})},r.prototype.switchGameState=function(t){this.currentGameState=t;switch(this.currentGameState){case e.GAME_STATE.INIT:this.currentGameStateFunction=this.initGame;break;case e.GAME_STATE.LEVEL_UP:this.currentGameStateFunction=this.levelUp;break;case e.GAME_STATE.PLAY:this.currentGameStateFunction=this.play}},r.prototype.levelUp=function(){this.players.forEach(function(e){e.weapons.forEach(function(e){})}),this.switchGameState(e.GAME_STATE.PLAY)},r.prototype.drawTitle=function(){var e=this.ctx;e.save(),e.font="20px Georgia",e.fillStyle="white",e.fillText("Press space to start game!",this.background.height/2,this.background.width/2),e.restore()},r.prototype.initGame=function(){this.drawBackground(),this.render(),this.drawTitle(),this.checkKeys()},r.prototype.checkKeys=function(){this.currentGameState===e.GAME_STATE.INIT&&this.keyPressList[32]&&this.switchGameState(e.GAME_STATE.LEVEL_UP)},r.prototype.play=function(){this.drawBackground(),this.update(),this.render(),this.checkKeys()},r.prototype.run=function(){this.currentGameStateFunction(),window.requestAnimationFrame(this.run.bind(this))},r}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i});