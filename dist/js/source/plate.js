define(["require","source/enum","source/weaponFactory","source/util"],function(e,t,n,r){var i=function(n,r){this.shape=n,this.x=0,this.y=0,this.dx=0,this.dy=0,this.angle=Math.PI/2,this.size=r,this.state=0,this.speed=0,this.fillStyle="#0000FF",this.strokeBodyStyle="#0000FF",this.strokeHitedBodyStyle="#DF0101",this.strokeGunStyle="white",this.edgeWidth=r/2,this.blood=100,this.isDied=!1,this.isHit=!1,this.bullets=e("source/weaponFactory").makeBullets(t.BULLET.IRON_2,1e5),this.numOfFiredBullets=0,this.isShot=!1};return i.prototype.setPosition=function(e,t){this.x=e,this.y=t},i.prototype.hit=function(){this.isHit=!0,this.blood-=5,this.blood<=0&&(this.isDied=!0)},i.prototype.fireGunner=function(e){var t=this.bullets[this.numOfFiredBullets],n=r.calAngle(this.x,this.y,e.gunX,e.gunY);t.update(this.x,this.y,n),this.numOfFiredBullets++},i.prototype.fire=function(e){for(var t=0,n=e[t];t<e.length;t++)this.fireGunner(n)},i.prototype.update=function(e){this.x+=this.dx,this.y+=this.dy,this.isHit=this.isHit&&!this.isHit,e&&this.fire(e);for(var t=0;t<this.numOfFiredBullets;t++){var n=this.bullets[t];n.update()}},i.prototype.render=function(e){this.isHit?this.renderHitedPlate(e):(this.renderBody(e),this.renderGun(e)),this.renderBullets(e)},i.prototype.renderBullets=function(e){for(var t=0;t<this.numOfFiredBullets;t++)this.bullets[t].render(e)},i.prototype.renderHitedPlate=function(e){this.renderBody(e),this.renderGun(e)},i.prototype.renderGun=function(e){e.save(),e.beginPath(),e.translate(this.x,this.y),e.rotate(this.angle),e.moveTo(0,0),e.lineTo(25,0),e.closePath(),e.strokeStyle=this.strokeGunStyle,e.lineWidth=5,e.stroke(),e.restore()},i.prototype.renderBody=function(e){e.save(),e.translate(this.x,this.y),e.beginPath();switch(this.shape){case t.SHAPE_PLATE.ROUND:e.arc(0,0,this.size,0,2*Math.PI,!1);break;case t.SHAPE_PLATE.RECT:e.rect(0-this.size,0-this.size,this.size*2,this.size*2)}e.lineWidth=this.edgeWidth,e.strokeStyle=this.isHit?this.strokeHitedBodyStyle:this.strokeBodyStyle,e.stroke(),e.closePath(),e.restore()},i});